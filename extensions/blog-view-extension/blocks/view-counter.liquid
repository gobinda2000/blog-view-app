{{ 'article-app.css' | asset_url | stylesheet_tag }}
{% if block.settings.Enable_like_counter==true %}
<script src="{{ 'article-like-counter.js' | asset_url }}" defer></script>
{% endif %}
{% if block.settings.Enable_view_counter==true %}
<script src="{{ 'article-view-counter.js' | asset_url }}" defer></script>
{% endif %}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ block.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ block.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ block.settings.padding_top }}px;
      padding-bottom: {{ block.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="main-container section-{{ section.id }} section-{{ section.id }}-padding {{ block.settings.content_alignment }} page-width">
  {% if block.settings.Enable_view_counter==true %}
<div class="view-counter" data-article-id="{{ article.id }}">
  <img src="{{ 'See.svg' | asset_url }}" alt="Views" width="24" height="24">
  <span>{{ article.metafields.custom.view_count }}</span>
</div>
{% endif %}
{% if block.settings.Enable_like_counter==true %}
<div class="blog-likes like-counter" 
     data-article-id="{{ article.id }}" 
     data-customer-id="{% if customer %}{{ customer.id }}{% endif %}">
  <button class="like-button">
    <img src="{{ 'icon-thumb-up.svg' | asset_url }}" alt="Like" width="24" height="24">
  </button>
  <span class="like-count">{{ article.metafields.custom.like_count | default: 0 }}</span>
  <p class="like-message" style="display:none; margin-left:8px; font-size:14px;"></p>
</div>
{% endif %}
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const viewDiv = document.querySelector(".view-counter");
    if (viewDiv) {
      const tracker = new ArticleViewTracker(
        "{{ block.settings.view_count_api_url }}",
        viewDiv
      );
      tracker.sendView();
    } else {
      console.error("View counter element not found!");
    }
  });

  document.addEventListener("DOMContentLoaded", () => {
    const likeDiv = document.querySelector(".blog-likes");
    if (likeDiv) {
      const tracker = new ArticleLikeTracker(
        "{{ block.settings.like_count_api_url }}", // Your API endpoint
        likeDiv
      );
    } else {
      console.error("Like button element not found!");
    }
  });
</script>


{% schema %}
{
  "name": "View and Like Counter",
  "target": "section",
  "settings": [
    {
      "type": "select",
      "id": "content_alignment",
      "options": [
        {
          "value": "left",
          "label": "left"
        },
        {
          "value": "center",
          "label": "center"
        },
        {
          "value": "right",
          "label": "right"
        },
      ],
      "default": "center",
      "label": "t:settings_schema.global.settings.blog.content_alignment.label",
    },
    {
      "type": "header",
      "content": "t:settings_schema.global.settings.blog.section_padding.label"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "t:settings_schema.global.settings.blog.padding_top.label",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:settings_schema.global.settings.blog.padding_bottom.label",
      "default": 36
    },
    {
      "type": "header",
      "content": "t:settings_schema.global.settings.blog.view_counter_settings.label"
    },
     {
      "type": "checkbox",
      "id": "Enable_view_counter",
      "label": "t:settings_schema.global.settings.blog.show_view_count.label",
      "default": true
    },
    {
      "type": "text",
      "id": "view_count_api_url",
      "label": "t:settings_schema.global.settings.blog.view.label",
      "placeholder": "https://your-backend-endpoint.com"  
    },
     {
      "type": "header",
      "content": "t:settings_schema.global.settings.blog.like_counter_settings.label"
    },
     {
      "type": "checkbox",
      "id": "Enable_like_counter",
      "label": "t:settings_schema.global.settings.blog.show_like_count.label",
      "default": true
    },
    {
      "type": "text",
      "id": "like_count_api_url",
      "label": "t:settings_schema.global.settings.blog.like.label",
      "placeholder": "https://your-backend-endpoint.com"
    },
    
  ]
}
{% endschema %}
